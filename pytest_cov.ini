# ============================================================================
# pytest_cov.ini - Configuração para COBERTURA GLOBAL do RC Gestor
# ============================================================================
# USO:
#   pytest -c pytest_cov.ini
#
# Gera relatórios de cobertura dos módulos da aplicação (src, adapters, infra,
# data, security) - não dos testes.
#
# Relatórios gerados:
#   - Terminal: sumário com linhas faltantes
#   - HTML: htmlcov/index.html
#   - JSON: reports/coverage.json
# ============================================================================

[pytest]
pythonpath = .
testpaths = tests

# Configuração completa para coverage global
addopts =
    -q
    --tb=short
    --import-mode=importlib
    --cov-config=.coveragerc
    --cov=src
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=json:reports/coverage.json
    --cov-report=xml:reports/coverage.xml
    --no-cov-on-fail
    --ignore=tests/modules/clientes_ui
    -m "not gui"

# TEST-005: Timeout padrão para evitar testes travados
timeout = 30
timeout_method = thread

# Acelerar coleta ignorando diretórios grandes sem testes
norecursedirs =
    .venv
    venv
    build
    dist
    .git
    __pycache__
    tests/archived
    artifacts
    exports
    reports
    htmlcov
    docs
    diagnostics
    tools
    scripts
    installer
    typings
    third_party
    migrations
    assets
    config

# Markers personalizados
markers =
    unit: testes unitários
    integration: testes de integração
    slow: testes lentos
    gui: testes que abrem janelas/widgets GUI (Tkinter/CustomTkinter/ttkbootstrap)
    gui: Tests that require GUI/display (skip on headless CI)

filterwarnings =
    ignore:.*SwigPyPacked has no __module__ attribute.*:DeprecationWarning
    ignore:.*SwigPyObject has no __module__ attribute.*:DeprecationWarning
    ignore:.*swigvarlink has no __module__ attribute.*:DeprecationWarning
    ignore:builtin type swigvarlink has no __module__ attribute:DeprecationWarning
    ignore:builtin type SwigPyPacked has no __module__ attribute:DeprecationWarning
    ignore:builtin type SwigPyObject has no __module__ attribute:DeprecationWarning
    ignore:unclosed database in <sqlite3.Connection.*:ResourceWarning
    ignore:.*PydanticDeprecatedSince212.*:DeprecationWarning
    ignore::pydantic.warnings.PydanticDeprecatedSince212
