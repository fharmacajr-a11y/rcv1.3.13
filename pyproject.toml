[tool.ruff]
src = ["src", "tests"]
line-length = 120
target-version = "py313"

[tool.ruff.lint]
select = [
    "E",    # pycodestyle errors
    "F",    # pyflakes
    "N",    # pep8-naming (PEP 8 naming conventions)
]
ignore = [
    "E501",  # linhas longas: manter flexível por enquanto
    "F403",  # star imports legados
    "F821",  # nomes indefinidos em caminhos condicionais
]

[tool.ruff.lint.per-file-ignores]
"tests/**/*" = ["D", "ANN", "S101"]
"tests/conftest.py" = ["E402"]  # Import após setup de ambiente é intencional
"tests\\conftest.py" = ["E402"]  # Import após setup de ambiente é intencional (Windows)
"tests/unit/core/test_auth_bootstrap_microfase.py" = ["E741", "F401"]
"tests/unit/modules/passwords/test_passwords_screen_ui.py" = ["F401", "F811", "F841"]
"tests/unit/modules/lixeira/test_lixeira_service.py" = ["E731"]
"typings/**/*" = ["N801", "N802", "N803", "N806"]  # Typings refletem APIs externas
"tests/utils/test_themes.py" = ["N802"]  # Mock classes simulam API externa
"tests/unit/infra/test_archives.py" = ["N802"]  # Test name matches ZIP64 standard
"tests/unit/adapters/test_adapters_supabase_storage_fase37.py" = ["N806"]  # Mock naming convention
"tests/unit/modules/clientes/forms/test_prepare_round12.py" = ["N806"]  # Mock naming convention
"docs/devtools/pdf_batch_from_images.py" = ["N806"]  # REPO_ROOT is a constant pattern

[tool.mypy]
ignore_missing_imports = true

[tool.deptry]
# Arquivos de requirements a usar
requirements_files = ["requirements.txt"]
requirements_files_dev = ["requirements-dev.txt"]

# Diretórios a excluir da análise
extend_exclude = [
    "tests",
    "docs",
    "htmlcov",
    "reports",
    "build",
    "dist",
    ".venv",
    ".venv_backup_20251204",
    ".pytest_cache",
    ".ruff_cache",
    "__pycache__",
    "migrations",
    "third_party",
    "typings",
    "installer",
    "scripts",
    "tools",
]

# Módulos first-party do projeto
known_first_party = ["src", "infra", "adapters", "data", "security", "helpers"]

# Mapeamento de nomes de pacotes para módulos importados
[tool.deptry.package_module_name_map]
Pillow = ["PIL"]

# Ignorar DEP002 para dependências transitivas e pacotes fixados
[tool.deptry.per_rule_ignores]
DEP002 = [
    "sv_ttk",
    "tkinterweb",
    "tkinterweb-tkhtml",
    "supabase-auth",
    "supabase-functions",
    "storage3",
    "realtime",
    "websockets",
    "psycopg",
    "psycopg-binary",
    "psycopg2-binary",
    "SQLAlchemy",
    "alembic",
    "h11",
    "h2",
    "hpack",
    "hyperframe",
    "certifi",
    "bcrypt",
    "PyJWT",
    "passlib",
    "cffi",
    "pycparser",
    "pydantic",
    "pydantic-settings",
    "pydantic_core",
    "annotated-types",
    "typing-inspection",
    "click",
    "rich",
    "colorama",
    "PyYAML-ft",
    "tzdata",
    "anyio",
    "sniffio",
    "idna",
    "charset-normalizer",
    "iniconfig",
    "packaging",
    "platformdirs",
]

[tool.vulture]
paths = ["app_gui.py", "application", "gui", "ui", "core", "infra", "utils", "adapters", "shared"]
ignore_decorators = ["@overload"]
min_confidence = 80
